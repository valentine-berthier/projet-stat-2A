---
title: "Analyse descriptive"
author: "Groupe 25"
date: "2024-01-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(ggplot2)
```

# CHARGEMENT DES DONNEES
```{r}
rm(list=ls())

AMR <- read_excel('donnees/donnees_AMR.xlsx')
str(AMR)
summary(AMR)

# Séparation des deux cas d'étude (animal et humain) version Florine
AMR_humaine <- AMR[which(AMR$famille=='humaine'),]
AMR_animale <- AMR[which(AMR$famille=='animale'),]

# Séparation des deux cas d'étude (animal et humain) version Maël
AMR_animale <- AMR %>%
  filter(famille == "animale")
AMR_humaine <- AMR %>%
  filter(famille == "humaine")
```

# VARIATIONS INTER-GROUPES
```{r}
# Pour les animaux, on regarde la moyenne de l'AMR pour chaque population
moyenne_AMR <- AMR_animale %>%
  group_by(population, famille) %>%
  summarize(moyenne_AMR = mean(`valeur AMR`))

# On regarde la variance inter-groupe (et l'écart-type car plus parlant)
AMR %>% summarize(ecart_type_AMR = sd(`valeur AMR`))
AMR %>%
  group_by(population, famille) %>%
  summarize(
    moyenne_AMR = mean(`valeur AMR`),
    .groups = 'drop'
  ) %>%
  ungroup() %>%
  summarize(
    SSB = sum((moyenne_AMR - mean(moyenne_AMR))^2 * n())
  )

# Plot des moyennes (agrandir le graphique pour la lisibilité)
ggplot(moyenne_AMR, aes(x = reorder(population, moyenne_AMR), y = moyenne_AMR, fill = famille)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Moyenne de l'AMR par population",
       x = "Population",
       y = "Moyenne de l'AMR") +
  theme_minimal()
```
Variation inter-groupes plutôt importante chez les animaux : de 13,02 pour la population veau, à 62,39 pour la population chat et écart-type de 16,97. Variance inter-groupe de 77353,6.

Pour poursuivre l'analyse :
Similarité entre les populations possédant des moyennes proches (chat et chien qui vivent avec l'Homme --> moyenne parmis les plus élevées) ?
La région influe-t-elle sur la moyenne et la variabilité ?
Les populations en abattoir possèdent-elles des moyennes sensiblement différentes des autres populations (ex : porc abattoir vs porc "classique") ?


# VARIATIONS INTRA-GROUPES
```{r}
AMR_animale %>%
  group_by(population, famille) %>%
  summarize(
    variance_intragroupe = sum((`valeur AMR` - mean(`valeur AMR`))^2),
    .groups = 'drop'
  )
```
Variance intra-groupe volatile en fonction des années --> d'où vient cette variabilité ? est-ce une tendance (croissante/décroissante) ou un phénomène aléatoire ?
Similarités entre les population possédant des variances 

Pour poursuivre l'analyse :
Graphe des moyennes selon les années.

# VISUALISATION DE DONNEES
```{r}
# Récupération des données nationales uniquement
AMR_animal_fr <- AMR_animale[which(AMR_animale$region=='Nationale'),]
AMR_humain_fr <- AMR_humaine[which(AMR_humaine$region=='Nationale'),]

boxplot(AMR_humain_fr$`valeur AMR`~AMR_humain_fr$population,
        main = "Valeur AMR par population sur la France entière",
        ylab = "Valuer AMR",
        xlab = "Population")
```

```{r}
# Récupération des données nationales uniquement
AMR %>%
  filter(population=='ES')%>%
  group_by(region)%>%
  mean(`valeur AMR`)

boxplot(AMR_humain_fr$`valeur AMR`~AMR_humain_fr$population,
        main = "Valeur AMR par population sur la France entière",
        ylab = "Valuer AMR",
        xlab = "Population")
```
val a fait du bon travail

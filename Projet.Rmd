---
title: "Donnees AMR"
author: "Valentine BERTHIER"
date: "2024-01-14"
output: html_document
bibliography : projet-stat-2A.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyr)
library(dplyr)
library(ggplot2)
```

Essayons de mettre en forme ce fichier avec chaque analyse que nous trouvons vraiment indispensable. Il faudrait que ce fichier ne contienne que les graphiques permettant la validation de l'indicateur.

# INTRODUCTION

## Importation des données

```{r}
AMR <- read_excel("donnees/donnees_AMR.xlsx")

# On renomme "bovin-abattoir" en "veau-abattoir"
AMR$population <- ifelse(AMR$population == "bovin-abattoir", "veau-abattoir", AMR$population)
```

## Transformation des jeux de donées

```{r}
AMR_nationale <- AMR %>%
  filter(region == "Nationale")
AMR_regionale <- AMR %>%
  filter(region != "Nationale")

AMR_nationale_animal <- AMR_nationale %>%
  filter(famille == "animale")
AMR_nationale_humain <- AMR_nationale %>%
  filter(famille == "humaine")

# Indicatrice selon que la population provient d'un abattoir ou non
AMR_nationale_animal$abattoir <- grepl("abattoir", AMR_nationale_animal$population, ignore.case = TRUE)
```

## Anlayse descriptive

Nous recherchons une liaison entre une variable qualitative (la population) et une variable quantitative (la valeur AMR). Pour cela, un boxplot permet d'avoir un premier aperçu des ressemblances.

```{r}
ggplot(AMR_regionale, aes(x = `valeur AMR`, y = reorder(population, `valeur AMR`, mean), fill = famille))+
  geom_boxplot()
# la fonciton reorder() permet de trier les boxplots
```
Sur ce graphique nous avons ajouté la répartition des familles qui permet d'avoir un premier aperçu sur les valeurs AMR humaines par rapport à animales.

Nous pouvons observer que les animaux "domestiques" (Chien, chat, cheval) ont une plus grande sensibilité que les animaux dits de "production" (volaille-abattoir, bovin-abattoir, poulet-abattoir) qui ont tendance à plus apparaître vers les faibles valeurs de sensibilité.

# Famille animale

```{r}
moyenne_AMR <- AMR_nationale_animal %>%
  group_by(population, famille, abattoir) %>%
  summarize(moyenne_AMR = mean(`valeur AMR`)) %>%
  arrange(moyenne_AMR)

ggplot(moyenne_AMR, aes(x = moyenne_AMR, y = reorder(population, moyenne_AMR), fill = abattoir))+
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Les animaux d'abattoir sont plus résistants aux antibiotiques",
       subtitle = "L'antibiorésistance (AMR) des différentes populations animales",
       caption = "Note: Moyenne calculée sur les années des données nationales.",
       y = "Population",
       x = "AMR moyen") +
  theme_minimal()  +
  guides(fill = FALSE) +
  scale_fill_manual(values = c("lightblue", "lightgreen"))

moyenne_AMR <- AMR_nationale_humain %>%
  group_by(population, famille) %>%
  summarize(moyenne_AMR = mean(`valeur AMR`)) %>%
  arrange(moyenne_AMR)

ggplot(moyenne_AMR, aes(x = moyenne_AMR, y = reorder(population, moyenne_AMR)))+
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "En ville, les individus sont moins résistants aux antibiotiques",
       subtitle = "L'antibiorésistance (AMR) des différentes populations humaines",
       caption = "Note: Moyenne calculée sur les années des données nationales.",
       y = "Population",
       x = "AMR moyen") +
  theme_minimal()
```

```{r}
ggplot(AMR_nationale_animal[which(AMR_nationale_animal$abattoir == TRUE),], aes(x = annee, y = `valeur AMR`, group = population, color = population)) +
  geom_line(stat = "summary", fun = "mean") +
  geom_point(stat = "summary", fun = "mean", size = 2) +
  labs(title = "Hausse générale de la sensibilité des populations en abattoir",
       subtitle = "Évolution des moyennes de l'AMR",
       x = NULL,
       y = "AMR moyen",
       color = "Population") +
  theme_minimal()

ggplot(AMR_nationale_animal[which(AMR_nationale_animal$abattoir == FALSE),], aes(x = annee, y = `valeur AMR`, group = population, color = population)) +
  geom_line(stat = "summary", fun = "mean") +
  geom_point(stat = "summary", fun = "mean", size = 2) +
  labs(title = "Baisse de la sensibilité aux antibiotiques des animaux domestiques",
       subtitle = "Évolution des moyennes de l'AMR",
       x = NULL,
       y = "AMR moyen",
       color = "Population") +
  theme_minimal()
```



# VALIDATION DE L'INDICATEUR

## Est-il possible de calculer l'indicateur pour toutes les caractéristiques ?

## L'indicateur est-il basé sur un nombre d'isolats plus faible (significativement ?) que d'autres indicateurs de résistance ?

## Les situations et les variables disponibles sont assez contrastées ?

## L'indicateur est-il lié à l'exposition aux antimicrobiens (= la pression sélective) ?
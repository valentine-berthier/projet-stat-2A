---
title: "analyse_valentine"
author: "Valentine BERTHIER"
date: "2024-01-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


0. LIBRARIES
```{r}
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)

```

Etude du jeu de données "donnees_AMR"
1. Importation du jeu de données
```{r}
rm(list=ls())
donnees_AMR <- read_excel("donnees/donnees_AMR.xlsx", 
col_types = c("text", "numeric", "text", 
"text", "text", "numeric", "numeric"))

```

2. Quelles sont les variables de ce jeu de données
```{r}
names(donnees_AMR)
```
3. Y-a-t-il des valeurs manquantes ? 
```{r}
which(is.na(donnees_AMR)=="TRUE")
```
Il y n'y a pas de valeurs manquantes

4. Quelles sont les catégories étudiées ? 
`r unique(donnees_AMR$famille)`

5. Quelles sont les familles étudiées ? 
`r unique(donnees_AMR$population)``

6. Lesquelles sont associées à l'étude des humains ? 
`r unique(donnees_AMR$population[which(donnees_AMR$famille=="humaine")])`

```{r}
#Nous les sauvegardons dans une variable
pop_humaine <- unique(donnees_AMR$population[which(donnees_AMR$famille=="humaine")])
```

7. 
```{r}
annees<-sort(unique(donnees_AMR$annee))

donnees_AMR%>%
  filter(famille=="humaine")%>%
  select(annee,population,famille,region,'valeur AMR')

donnees_humaines_nationales<-donnees_AMR%>%
  filter(famille=="humaine",region=='Nationale')%>%
  select(annee,population,'valeur AMR')%>%
  ggplot(aes(x=annee,y=`valeur AMR`))+ geom_col(aes(fill=population),position="dodge")+labs(title = "Etude de la pan-sensibilité aux antibiotiques sur les populations humaines",caption = "Cohorte : population de catégories humaine au niveau National \n Lecture : Les population en ville présentent une sensibilité plus élévée aux antibiotiques de 2012 à 2021 ")



  
```
7.2 Pour une étude au sein des régions 

```{r}

regions<-unique(donnees_AMR$region)
famille="humaine"
region="Grand Est"

max_AMR<-donnees_AMR%>%
  filter(famille=="humaine",region==region)%>%
  rename(v_AMR=`valeur AMR`)%>%
  select(v_AMR)%>%
  max()

pop_max<-donnees_AMR$population[which(donnees_AMR$`valeur AMR`==max_AMR)]
annee_max<-donnees_AMR$annee[which(donnees_AMR$`valeur AMR`==max_AMR)]

plot<-donnees_AMR%>%
  filter(famille=="humaine",region==region)%>%
  select(annee,population,'valeur AMR')%>%
  ggplot(aes(x=annee,y=`valeur AMR`))+ geom_col(aes(fill=population),position="dodge")+labs(title =str_glue("Etude de la pan-sensibilité aux antibiotiques sur les populations {famille}"),caption =str_glue("Cohorte : population de catégories humaine au niveau {region} \n","Lecture : Au niveau de : {region}, la population qui présente le plus haut taux de sensibilité aux antibiotiques ({max_AMR}) est :{pop_max} et ceci en {annee_max} "))

plot
```



8. CARTE
```{r}

```

8.1 Recupération des régions
```{r}
unique(donnees_AMR$region)
```

8.2 Chargement des données issues de l'INSEE pour associer la carte
```{r}
library(readr)
region2019 <- read_csv("donnees/region2019.csv")
```

```{r}
# Recuperer la France Metropolitaine de {rnaturalearth}
library(rnaturalearth)
france <- ne_states(country = "France", returnclass = "sf") %>% 
  filter(!name %in% c("Guyane française","Mayotte"))
# Carte
tm_shape(france) +
  tm_polygons(col = "")

plot_ly(france, split = ~name, color = ~provnum_ne) %>% 
  layout(showlegend = FALSE) 
```

8.3 Récupérons les données humaine / ES de 2012

```{r}
library(dplyr)
ES_2012<-donnees_AMR%>%
  filter(annee==2012 & famille=='humaine')%>%
  select(region,`valeur AMR`,population)%>%
  arrange(region)
  
# Remarque : toutes les années ne sont pas renseignées pour toutes les population humaine
```



9. Chargement des données en vrac

```{r}
library(readr)
library(readxl)

# Les régions 

regions <- read_csv("donnees/region2019.csv")

# données par régions 
part_classe_age <- read_excel("donnees/série Insee part des classes d'age dans population.xlsx")


#donnees AMR
Classeur4 <- read_excel("donnees/Classeur4.xlsx")
D_animale_nationale_avec_alea_corrige <- read_excel("donnees/D_animale_nationale_avec_alea_corrige.xlsx")

```





